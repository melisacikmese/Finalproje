{% extends "base.html" %}

{% block content %}
<div class="page-header">
    <h1>üîÑ √ñd√ºn√ß ƒ∞≈ülemleri</h1>
    <button class="btn btn-primary" onclick="openModal('addLoanModal')">+ Yeni √ñd√ºn√ß Ver</button>
</div>

<!-- Filtre Butonlarƒ± -->
<div class="filter-tabs">
    <a href="{{ url_for('loans') }}?status=all" class="filter-tab {% if status_filter == 'all' %}active{% endif %}">
        T√ºm√º
    </a>
    <a href="{{ url_for('loans') }}?status=active" class="filter-tab {% if status_filter == 'active' %}active{% endif %}">
        Aktif √ñd√ºn√ßler
    </a>
    <a href="{{ url_for('loans') }}?status=returned" class="filter-tab {% if status_filter == 'returned' %}active{% endif %}">
        ƒ∞ade Edilenler
    </a>
    <a href="{{ url_for('loans') }}?status=overdue" class="filter-tab {% if status_filter == 'overdue' %}active{% endif %}">
        Gecikenler
    </a>
</div>

<!-- √ñd√ºn√ß Listesi -->
<div class="table-container">
    {% if loans %}
    <table class="data-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Kitap</th>
                <th>Yazar</th>
                <th>√úye</th>
                <th>√ñd√ºn√ß Tarihi</th>
                <th>Son Tarih</th>
                <th>ƒ∞ade Tarihi</th>
                <th>Durum</th>
                <th>ƒ∞≈ülemler</th>
            </tr>
        </thead>
        <tbody>
            {% for loan in loans %}
            <tr class="{% if loan.status == 'active' and loan.due_date < now().strftime('%Y-%m-%d') %}overdue-row{% endif %}">
                <td>{{ loan.id }}</td>
                <td><strong>{{ loan.book_title }}</strong></td>
                <td>{{ loan.book_author }}</td>
                <td>{{ loan.member_name }}</td>
                <td>{{ loan.loan_date }}</td>
                <td>
                    {{ loan.due_date }}
                    {% if loan.status == 'active' and loan.due_date < now().strftime('%Y-%m-%d') %}
                    <span class="badge badge-danger">GECƒ∞KMƒ∞≈û</span>
                    {% endif %}
                </td>
                <td>{{ loan.return_date or '-' }}</td>
                <td>
                    {% if loan.status == 'active' %}
                    <span class="badge badge-warning">Aktif</span>
                    {% else %}
                    <span class="badge badge-success">ƒ∞ade Edildi</span>
                    {% endif %}
                </td>
                <td>
                    {% if loan.status == 'active' %}
                    <a href="{{ url_for('return_loan', loan_id=loan.id) }}" 
                       class="btn btn-sm btn-success"
                       onclick="return confirm('Bu kitabƒ± iade almak istediƒüinizden emin misiniz?')">
                        ‚úÖ ƒ∞ade Al
                    </a>
                    <a href="{{ url_for('extend_loan', loan_id=loan.id) }}" 
                       class="btn btn-sm btn-info"
                       onclick="return confirm('√ñd√ºn√ß s√ºresini 7 g√ºn uzatmak istiyor musunuz?')">
                        ‚è∞ Uzat
                    </a>
                    {% else %}
                    <span class="text-muted">-</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <div class="empty-icon">üîÑ</div>
        <h3>√ñd√ºn√ß i≈ülemi bulunamadƒ±</h3>
        <p>Yeni √∂d√ºn√ß i≈ülemi ba≈ülatmak i√ßin yukarƒ±daki butona tƒ±klayƒ±n</p>
    </div>
    {% endif %}
</div>

<!-- √ñd√ºn√ß Verme Modal -->
<div id="addLoanModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Yeni √ñd√ºn√ß ƒ∞≈ülemi</h2>
            <button class="modal-close" onclick="closeModal('addLoanModal')">&times;</button>
        </div>
        <form method="POST" action="{{ url_for('add_loan') }}">
            <div class="form-grid">
                <div class="form-group full-width">
                    <label>Kitap Se√ß *</label>
                    <select name="book_id" required class="form-select">
                        <option value="">Kitap se√ßin...</option>
                        {% for book in available_books %}
                        <option value="{{ book.id }}">
                            {{ book.title }} - {{ book.author }} ({{ book.available }} adet mevcut)
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group full-width">
                    <label>√úye Se√ß *</label>
                    <select name="member_id" required class="form-select">
                        <option value="">√úye se√ßin...</option>
                        {% for member in members %}
                        <option value="{{ member.id }}">
                            {{ member.name }} ({{ member.email }})
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>√ñd√ºn√ß S√ºresi (G√ºn)</label>
                    <input type="number" name="days" value="14" min="1" max="90" required>
                </div>
                <div class="form-group full-width">
                    <label>Notlar</label>
                    <textarea name="notes" rows="3" placeholder="ƒ∞steƒüe baƒülƒ± notlar..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-success">üíæ √ñd√ºn√ß Ver</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('addLoanModal')">ƒ∞ptal</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}